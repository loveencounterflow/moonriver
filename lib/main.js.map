{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'MOONRIVER/NG'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n#...........................................................................................................\ntypes                     = null\nUTIL                      = require 'node:util'\n{ hide\n  def }                   = GUY.props\nnameit                    = ( name, f ) -> def f, 'name', { value: name, }\n{ stf_prefix\n  get_types }             = require './types'\nstf                       = ( name ) -> stf_prefix + ( if Array.isArray name then name[ 0 ] else name )\n\n\n#===========================================================================================================\nclass Segment\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    hide @, 'types',      get_types()\n    @types.create.mr_segment_cfg cfg\n    @input          = cfg.input\n    @output         = cfg.output\n    @has_finished   = null\n    @transform_type = null\n    hide @, 'transform',  @_as_transform cfg.fitting\n    hide @, '_send', send = ( d ) => @output.push d; d ### 'inner' send method ###\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _as_transform: ( fitting ) ->\n    ###\n\n    * `fitting`: a value that may be used as (the central part of) a transform in a pipeline. This may be a\n      function of arity 2 (a transducer), a list (a source) &c.\n    * `transform`: one of the serial elements that constitute a pipeline. While a `fitting` may be of\n      various types, a `transform` is always a function. `transform`s have a `type` attribute which takes\n      one of the following values:\n      * `source`: a `transform` that does not take any arguments and will yield one value per call\n      * `observer`: a `transform` that takes one argument (the current value) and does not send any values\n        into the pipeline; the value an observer gets called with will be the same value that the next\n        transformer will be called with. Note that if an observer receives a mutable value it can modify it\n        and thereby affect one data item at a time.\n      * `transducer`: a `transform` that takes two arguments, the current data item and a `send()` function\n        that can be used any number of times to send values to the ensuing transform.\n\n    ###\n    if @types.isa.mr_source_fitting fitting\n      R               = @_get_source_transform fitting\n      @transform_type = 'source'\n    #.......................................................................................................\n    else\n      R = fitting\n      switch arity = R.length ? 0\n        when 1 then @transform_type = 'observer'\n        when 2 then @transform_type = 'transducer'\n        else throw new Error \"^mr.e#1^ fittings with arity #{arity} not implemented\"\n    #.......................................................................................................\n    nameit 'ƒ', R if R.name is ''\n    return R\n\n\n  #=========================================================================================================\n  # SOURCE TRANSFORMS\n  #---------------------------------------------------------------------------------------------------------\n  _get_source_transform: ( source ) ->\n    type = @types.type_of source\n    unless ( method = @[stf type] )?\n      throw new Error \"^mr.e#2^ unable to convert a #{type} to a transform\"\n    @has_finished = false\n    R = method.call @, source\n    return nameit type, R if R.name is ''\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  [stf'generator']: ( source ) ->\n    @has_finished = false\n    return ( send ) =>\n      return null if @has_finished\n      dsc           = source.next()\n      @has_finished = dsc.done\n      send dsc.value unless @has_finished\n      return null\n\n  #---------------------------------------------------------------------------------------------------------\n  [stf'text']: ( source ) ->\n    letter_re     = /./uy\n    @has_finished = false\n    return nameit '√txt', ( send ) =>\n      return null if @has_finished\n      unless ( match = source.match letter_re )?\n        @has_finished = true\n        return null\n      send match[ 0 ]\n      return null\n\n  #---------------------------------------------------------------------------------------------------------\n  [stf'generatorfunction']: ( source ) -> @_get_source_transform source()\n  [stf'arrayiterator']:     ( source ) -> @[stf'generator'] source\n  [stf'setiterator']:       ( source ) -> @[stf'generator'] source\n  [stf'mapiterator']:       ( source ) -> @[stf'generator'] source\n  [stf'list']:              ( source ) -> nameit '√lst', @[stf'generator'] source.values()\n  [stf'object']:            ( source ) -> nameit '√obj', @[stf'generator'] ( -> yield [ k, v, ] for k, v of source )()\n  [stf'set']:               ( source ) -> nameit '√set', @[stf'generator'] source.values()\n  [stf'map']:               ( source ) -> nameit '√map', @[stf'generator'] source.entries()\n\n\n  #=========================================================================================================\n  #\n  #---------------------------------------------------------------------------------------------------------\n  ### 'outer' send method ###\n  send: ( d ) -> @input.push d; d\n\n  #---------------------------------------------------------------------------------------------------------\n  process: ->\n    if @transform_type is 'source'\n      @_send @input.shift() while @input.length > 0 ### TAINT could be done with `.splice()` ###\n      return 0 if @transform.has_finished\n      @transform @_send\n      return 1\n    if @input.length > 0\n      d = @input.shift()\n      switch @transform_type\n        when 'observer'\n          @transform  d\n          @_send      d\n        when 'transducer'\n          @transform d, @_send\n        else\n          throw new Error \"^mr.e#3^ internal error: unknown transform type #{rpr @transform_type}\"\n      return 1\n    return 0\n\n  #---------------------------------------------------------------------------------------------------------\n  [UTIL.inspect.custom]:  -> @toString()\n  toString:               -> \"#{rpr @input} ▶ #{@transform.name} ▶ #{rpr @output}\"\n\nclass Async_segment extends Segment\n\n  #---------------------------------------------------------------------------------------------------------\n  process: ->\n    if @transform_type is 'source'\n      @_send @input.shift() while @input.length > 0 ### TAINT could be done with `.splice()` ###\n      return 0 if @transform.has_finished\n      @transform @_send\n      return 1\n    if @input.length > 0\n      d = @input.shift()\n      d = await d if d instanceof Promise\n      switch @transform_type\n        when 'observer'\n          @transform  d\n          @_send      d\n        when 'transducer'\n          @transform d, @_send\n        else\n          throw new Error \"^mr.e#3^ internal error: unknown transform type #{rpr @transform_type}\"\n      return 1\n    return 0\n\n\n#===========================================================================================================\nclass Reporting_collector\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( callback ) ->\n    hide @, 'callback', callback\n    hide @, 'd',        []\n    GUY.props.def @,  'length',   get: -> @d.length\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  push:     ( d ) -> @callback +1; @d.push d\n  unshift:  ( d ) -> @callback +1; @d.unshift d\n  pop:            -> @callback -1; @d.pop()\n  shift:          -> @callback -1; @d.shift()\n\n  #---------------------------------------------------------------------------------------------------------\n  [UTIL.inspect.custom]:  -> @toString()\n  toString:               -> rpr @d\n\n\n#===========================================================================================================\nclass Pipeline\n\n  #---------------------------------------------------------------------------------------------------------\n  @segment_class: Segment\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    cfg                 = { {}..., cfg..., }\n    # cfg                 = types.create.mr_pipeline_cfg cfg\n    @datacount          = 0\n    @input              = @_new_collector()\n    @output             = [] ### pipeline output buffer does not participate in datacount ###\n    @segments           = []\n    @on_before_step     = cfg.on_before_step ? null\n    @on_after_step      = cfg.on_after_step  ? null\n    @on_before_process  = cfg.on_before_process ? null\n    @on_after_process   = cfg.on_after_process  ? null\n    hide  @, '$',             nameit '$', @_remit.bind @\n    hide  @, 'types',         get_types()\n    hide  @, 'sources',       []\n    def   @, 'has_finished',  get: -> ( @datacount < 1 ) and @sources.every ( s ) -> s.has_finished\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _new_collector:                   -> new Reporting_collector ( delta ) => @datacount += delta\n\n\n  #=========================================================================================================\n  # BUILDING PIPELINE FROM SEGMENTS\n  #---------------------------------------------------------------------------------------------------------\n  # _remit: ( modifiers, fitting ) ->\n  _remit: ( fitting ) ->\n    if ( count = @segments.length ) is 0\n      input               = @input\n    else\n      prv_segment         = @segments[ count - 1 ]\n      prv_segment.output  = @_new_collector()\n      input               = prv_segment.output\n    try R = new @constructor.segment_class { input, fitting, output: @output, } catch error\n      error.message = error.message + \"\\n\\n^mr.e#4^ unable to convert a #{@types.type_of fitting} into a segment\"\n      throw error\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  push: ( P... ) ->\n    R = @_remit P...\n    @segments.push  R\n    @sources.push   R if R.transform_type is 'source'\n    return R\n\n\n  #=========================================================================================================\n  # SENDING DATA\n  #---------------------------------------------------------------------------------------------------------\n  send: ( d ) -> @input.push d; d\n\n\n  #=========================================================================================================\n  # PROCESSING\n  #---------------------------------------------------------------------------------------------------------\n  process: ->\n    @on_before_process() if @on_before_process?\n    for segment, segment_idx in @segments\n      @on_before_step segment_idx if @on_before_step?\n      segment.process()\n      @on_after_step segment_idx if @on_after_step?\n    @on_after_process() if @on_after_process?\n    return null\n\n\n  #=========================================================================================================\n  # ITERATING OVER AND RETRIEVING RESULTS\n  #---------------------------------------------------------------------------------------------------------\n  run: -> ( d for d from @walk() )\n  walk: ->\n    loop\n      @process()\n      yield d for d in @output\n      @output.length = 0\n      break if @has_finished\n    return null\n\n\n  #=========================================================================================================\n  # CLI REPRESENTATION\n  #---------------------------------------------------------------------------------------------------------\n  [UTIL.inspect.custom]:  -> @toString()\n  toString:               ->\n    R = []\n    for segment in @segments\n      R.push rpr segment.input\n      R.push '▶'\n      R.push segment.transform.name\n      R.push '▶'\n    R.push rpr @output\n    return R.join ' '\n\n\n#===========================================================================================================\nclass Async_pipeline extends Pipeline\n\n  #---------------------------------------------------------------------------------------------------------\n  @segment_class: Async_segment\n\n  #=========================================================================================================\n  # PROCESSING\n  #---------------------------------------------------------------------------------------------------------\n  process: ->\n    @on_before_process() if @on_before_process?\n    for segment, segment_idx in @segments\n      @on_before_step segment_idx if @on_before_step?\n      await segment.process()\n      @on_after_step segment_idx if @on_after_step?\n    @on_after_process() if @on_after_process?\n    return null\n\n  #=========================================================================================================\n  # CLI REPRESENTATION\n  #---------------------------------------------------------------------------------------------------------\n  run: -> ( d for await d from @walk() )\n  walk: ->\n    loop\n      await @process()\n      yield ( if d instanceof Promise then await d else d ) for d in @output\n      @output.length = 0\n      break if @has_finished\n    return null\n\n\n############################################################################################################\nmodule.exports = { Segment, Reporting_collector, Pipeline, Async_pipeline, }\n\n"
  ]
}